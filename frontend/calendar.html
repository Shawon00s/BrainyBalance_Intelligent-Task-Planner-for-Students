<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Integration - BrainyBalance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#6366f1',
                        'primary-dark': '#5856eb',
                        'accent': '#fbbf24',
                        'accent-dark': '#f59e0b',
                        'dark-bg': '#0a0a0b',
                        'dark-card': '#1a1a1b',
                        'dark-border': '#2d2d30',
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'gradient-secondary': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                        'gradient-accent': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                        'gradient-dark': 'linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%)',
                        'gradient-card': 'linear-gradient(135deg, #1e1e1f 0%, #2a2a2b 100%)',
                    }
                }
            }
        }
    </script>
    <style>
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            display: none;
        }

        .message.success {
            background-color: #10b981;
        }

        .message.error {
            background-color: #ef4444;
        }

        .glass-card {
            background: rgba(26, 26, 27, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="font-inter bg-gradient-dark min-h-screen text-white">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-gray-900/95 to-black/95 backdrop-blur-md border-b border-dark-border">
        <div class="max-w-7xl mx-auto px-4 lg:px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <div
                        class="flex items-center space-x-2 text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                        <i
                            class="fas fa-graduation-cap text-2xl bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"></i>
                        <span>BrainyBalance</span>
                    </div>
                    <div class="hidden md:flex space-x-6">
                        <a href="dashboard.html"
                            class="text-gray-300 hover:text-indigo-400 transition-colors">Dashboard</a>
                        <a href="tasks.html" class="text-gray-300 hover:text-indigo-400 transition-colors">Tasks</a>
                        <a href="schedule.html"
                            class="text-gray-300 hover:text-indigo-400 transition-colors">Schedule</a>
                        <a href="analytics.html"
                            class="text-gray-300 hover:text-indigo-400 transition-colors">Analytics</a>
                        <a href="pomodoro.html"
                            class="text-gray-300 hover:text-indigo-400 transition-colors">Pomodoro</a>
                        <a href="calendar.html" class="text-indigo-400 border-b-2 border-indigo-400 pb-1">
                            <i class="fab fa-google mr-1"></i>Calendar
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="relative text-gray-300 hover:text-indigo-400 transition-colors">
                        <i class="fas fa-bell text-xl"></i>
                        <span
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <div class="relative group">
                        <button class="flex items-center space-x-2 text-gray-300 hover:text-white">
                            <img src="https://via.placeholder.com/32x32/6366f1/ffffff?text=U" alt="Profile"
                                class="w-8 h-8 rounded-full profile-image">
                            <span class="hidden md:block user-name">User</span>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        <div
                            class="absolute right-0 top-full mt-2 w-48 bg-dark-card border border-dark-border rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50">
                            <a href="profile.html"
                                class="block px-4 py-2 text-gray-300 hover:bg-gray-800 hover:text-white">
                                <i class="fas fa-user mr-2"></i>Profile Settings
                            </a>
                            <hr class="border-dark-border mt-1">
                            <button onclick="logout()"
                                class="block w-full text-left px-4 py-2 text-red-400 hover:bg-gray-800">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 lg:px-6 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1
                        class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                        <i class="fab fa-google mr-3"></i>Calendar Integration
                    </h1>
                    <p class="text-gray-400 mt-2">
                        Sync your tasks and pomodoro sessions with Google Calendar to stay organized across all your
                        devices.
                    </p>
                </div>
            </div>
        </div>

        <!-- Connection Status Card -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                <i class="fas fa-link mr-3 text-indigo-400"></i>
                Connection Status
            </h2>
            <div id="calendar-status" class="mb-6">
                <div class="flex items-center text-gray-400">
                    <div class="w-2 h-2 bg-gray-400 rounded-full mr-3 animate-pulse"></div>
                    Checking connection...
                </div>
            </div>

            <div class="flex space-x-4">
                <button id="connect-google-calendar"
                    class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center transform hover:scale-105"
                    style="display: none;">
                    <i class="fab fa-google mr-2"></i>
                    Connect Google Calendar
                </button>

                <button id="disconnect-google-calendar"
                    class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center transform hover:scale-105"
                    style="display: none;">
                    <i class="fas fa-unlink mr-2"></i>
                    Disconnect
                </button>
            </div>
        </div>

        <!-- Sync Settings Card -->
        <div id="calendar-sync-settings" class="glass-card rounded-xl p-6 mb-6" style="display: none;">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                <i class="fas fa-cog mr-3 text-indigo-400"></i>
                Sync Settings
            </h2>

            <div class="space-y-6">
                <!-- Calendar Selection -->
                <div>
                    <label for="calendar-dropdown" class="block text-sm font-medium text-gray-300 mb-2">
                        Select Calendar
                    </label>
                    <select id="calendar-dropdown"
                        class="w-full px-4 py-3 border border-dark-border rounded-lg bg-dark-card text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                        <option value="primary">Primary Calendar</option>
                    </select>
                </div>

                <!-- Sync Options -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div
                        class="flex items-center p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-indigo-500 transition-colors">
                        <input type="checkbox" id="sync-tasks"
                            class="h-4 w-4 text-indigo-500 focus:ring-indigo-500 border-gray-600 rounded bg-dark-card">
                        <label for="sync-tasks" class="ml-3 text-sm text-gray-300 flex items-center">
                            <i class="fas fa-tasks mr-2 text-blue-400"></i>
                            Sync Tasks
                        </label>
                    </div>

                    <div
                        class="flex items-center p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-indigo-500 transition-colors">
                        <input type="checkbox" id="sync-pomodoro"
                            class="h-4 w-4 text-indigo-500 focus:ring-indigo-500 border-gray-600 rounded bg-dark-card">
                        <label for="sync-pomodoro" class="ml-3 text-sm text-gray-300 flex items-center">
                            <i class="fas fa-clock mr-2 text-red-400"></i>
                            Sync Pomodoro Sessions
                        </label>
                    </div>

                    <div
                        class="flex items-center p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-indigo-500 transition-colors">
                        <input type="checkbox" id="sync-schedule"
                            class="h-4 w-4 text-indigo-500 focus:ring-indigo-500 border-gray-600 rounded bg-dark-card">
                        <label for="sync-schedule" class="ml-3 text-sm text-gray-300 flex items-center">
                            <i class="fas fa-calendar mr-2 text-green-400"></i>
                            Sync Schedule
                        </label>
                    </div>

                    <div
                        class="flex items-center p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-indigo-500 transition-colors">
                        <input type="checkbox" id="auto-sync"
                            class="h-4 w-4 text-indigo-500 focus:ring-indigo-500 border-gray-600 rounded bg-dark-card">
                        <label for="auto-sync" class="ml-3 text-sm text-gray-300 flex items-center">
                            <i class="fas fa-sync mr-2 text-purple-400"></i>
                            Auto Sync
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works Card -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                <i class="fas fa-question-circle mr-3 text-indigo-400"></i>
                How It Works
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-dark-bg rounded-lg border border-dark-border">
                    <div
                        class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-tasks text-white text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-white mb-2">Tasks</h3>
                    <p class="text-sm text-gray-400">
                        Your tasks with due dates will appear as events in your Google Calendar with task emojis (üìö).
                    </p>
                </div>

                <div class="text-center p-4 bg-dark-bg rounded-lg border border-dark-border">
                    <div
                        class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-clock text-white text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-white mb-2">Pomodoro</h3>
                    <p class="text-sm text-gray-400">
                        Completed pomodoro sessions will be logged as focus time blocks with tomato emojis (üçÖ).
                    </p>
                </div>

                <div class="text-center p-4 bg-dark-bg rounded-lg border border-dark-border">
                    <div
                        class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-sync text-white text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-white mb-2">Auto Sync</h3>
                    <p class="text-sm text-gray-400">
                        Enable auto sync to automatically add new tasks and sessions to your calendar.
                    </p>
                </div>
            </div>
        </div>

        <!-- Sync History Card -->
        <div class="glass-card rounded-xl p-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                <i class="fas fa-history mr-3 text-indigo-400"></i>
                Recent Sync Activity
            </h2>

            <div id="sync-history" class="space-y-3">
                <div class="text-center py-8 text-gray-400">
                    <p class="text-sm">No sync activity yet</p>
                    <p class="text-xs mt-1">Connect your calendar and sync some tasks to see activity here!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Message container -->
    <div id="message" class="message"></div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/googleCalendar.js"></script>
    <script>
        // Initialize calendar integration when page loads
        document.addEventListener('DOMContentLoaded', async function () {
            // Check authentication
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // Load user profile
            await loadUserProfile();

            // Initialize Google Calendar integration
            await googleCalendar.init();

            // Load sync history
            loadSyncHistory();
        });

        // Load sync history
        async function loadSyncHistory() {
            try {
                const response = await fetch('http://localhost:3000/api/calendar/sync-history', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displaySyncHistory(data.syncedEvents);
                }
            } catch (error) {
                console.error('Error loading sync history:', error);
            }
        }

        // Display sync history
        function displaySyncHistory(events) {
            const container = document.getElementById('sync-history');

            if (!events || events.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <p class="text-sm">No sync activity yet</p>
                        <p class="text-xs mt-1">Connect your calendar and sync some tasks to see activity here!</p>
                    </div>
                `;
                return;
            }

            const historyHTML = events.slice(0, 10).map(event => {
                const icon = event.eventType === 'task' ? 'üìö' :
                    event.eventType === 'pomodoro' ? 'üçÖ' : 'üìÖ';
                const timeAgo = getTimeAgo(new Date(event.createdAt));

                return `
                    <div class="flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${icon}</span>
                            <div>
                                <p class="text-sm font-medium text-white">
                                    ${event.eventType.charAt(0).toUpperCase() + event.eventType.slice(1)} synced to calendar
                                </p>
                                <p class="text-xs text-gray-400">${timeAgo}</p>
                            </div>
                        </div>
                        <div class="text-xs text-gray-400">
                            <i class="fas fa-check-circle text-green-400"></i>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = historyHTML;
        }

        // Helper function for time formatting
        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (minutes < 60) {
                return minutes <= 1 ? 'Just now' : `${minutes} minutes ago`;
            } else if (hours < 24) {
                return hours === 1 ? '1 hour ago' : `${hours} hours ago`;
            } else {
                return days === 1 ? '1 day ago' : `${days} days ago`;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // Show message function
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';

            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }
    </script>
</body>

</html>